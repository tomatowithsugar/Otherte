<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>전시대 봉사 시간표</title>
    <style>
        * { box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 15px;
            background: #F2F2F7;
            color: #1C2526;
            font-size: 16px;
            line-height: 1.5;
        }
        h1 {
            color: #007AFF;
            font-size: 1.8em;
            text-align: center;
            margin: 0 0 20px;
        }
        form {
            background: #FFFFFF;
            padding: 15px;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 20px;
        }
        label {
            font-size: 0.95em;
            color: #1C2526;
            font-weight: 500;
        }
        input[type="time"], input[type="number"] {
            padding: 10px;
            border: 1px solid #D1D1D6;
            border-radius: 10px;
            font-size: 1em;
            background: #F7F7F8;
            width: 100%;
        }
        input[type="number"] { max-width: 100px; }
        button {
            padding: 12px;
            font-size: 0.95em;
            border-radius: 10px;
            border: none;
            cursor: pointer;
            color: #FFFFFF;
            background: #007AFF;
            transition: opacity 0.2s;
        }
        button:active { opacity: 0.7; }
        #selectedParticipants {
            font-size: 0.9em;
            color: #FF9500;
            min-height: 20px;
            margin: 10px 0;
        }
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            padding: 10px;
        }
        .modal-content {
            background: #FFFFFF;
            padding: 20px;
            border-radius: 16px;
            max-width: 90%;
            max-height: 85vh;
            margin: 5vh auto;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        .modal-content h2 {
            margin: 0;
            font-size: 1.2em;
            color: #1C2526;
        }
        .close {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 28px;
            color: #FF3B30;
            cursor: pointer;
        }
        .participant-category {
            margin: 10px 0;
        }
        .participant-category h3 {
            font-size: 1em;
            color: #1C2526;
            margin: 0 0 8px;
        }
        .checkbox-container {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9em;
            color: #1C2526;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            background: #FFFFFF;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            margin-top: 20px;
            font-size: 0.9em;
        }
        th, td {
            border: 1px solid #D1D1D6;
            padding: 12px;
            text-align: center;
        }
        th {
            background: #007AFF;
            color: #FFFFFF;
        }
        tr:nth-child(even) { background: #F7F7F8; }
        @media (max-width: 600px) {
            body { padding: 10px; }
            h1 { font-size: 1.5em; }
            form { padding: 12px; }
            input[type="time"], input[type="number"], button { font-size: 0.9em; }
            .modal-content {
                width: 100%;
                height: 100%;
                margin: 0;
                border-radius: 0;
                padding: 15px;
            }
            table { font-size: 0.85em; }
        }
    </style>
</head>
<body>
    <h1>전시대 봉사 시간표</h1>
    <form id="schedulerForm">
        <label for="startTime">시작 시간</label>
        <input type="time" id="startTime" name="startTime" required>
        <label for="endTime">마치는 시간</label>
        <input type="time" id="endTime" name="endTime" required>
        <label for="stands">전시대 개수</label>
        <input type="number" id="stands" name="stands" min="1" required>
        <button type="button" onclick="openModal()">참여자 선택</button>
        <div id="selectedParticipants"></div>
        <button type="button" onclick="generateSchedule()">시간표 생성</button>
    </form>
    <div id="schedule"></div>

    <!-- 모달 -->
    <div id="modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">×</span>
            <h2>참여자 선택</h2>
            <div id="participantList"></div>
            <button onclick="confirmSelection()">선택 완료</button>
        </div>
    </div>

    <script>
        const brothers = ["김기권", "김상연", "김은석", "김인기", "김철호", "박상익", "박원준", "박종화", "박진걸", "박희범", "박희종", "사영환", "서기원", "서정길", "양재은", "양진우", "이목영", "이선", "이종호", "이현석", "임종목", "임현수", "전종경", "전진해", "전필용", "정순도", "정종민", "정진수", "정해균"];
        const sisters = ["강성임", "강승미", "강승희", "곽순호", "권영미", "권영숙", "권수진", "김경애", "김귀자", "김동임", "김복실", "김솔", "김영아", "김영애", "김영순", "김옥순A", "김옥순B", "김은희", "김인순", "김인희", "김정숙", "김춘조", "김희재", "문설형", "민규희", "박선아", "박순례", "박여자", "박은숙", "박현숙", "백경자", "변현숙", "서광옥", "서혜경", "손귀선", "송옥순", "신부지", "신연순", "심자인", "안영자", "양동순", "양지예", "양지은", "연선미", "용옥자", "유민지", "유순지", "우옥희", "이경순", "이경현", "이금덕", "이금자", "이명윤", "이병임", "이아영", "이애선", "이영자", "이영재", "이재희", "이지Unless", "이채은", "이화숙", "이희숙", "이희열", "임규환", "임귀녀", "임순자", "임애진", "임여진", "장평원", "정송은", "정옥연", "조금순", "조명자", "조인순", "최건자", "최명수", "최문숙", "최연진", "홍명순", "홍은희"];
        const children = ["박시우", "양다솜", "이채은"];
        const groups = ["동부집단", "서부집단", "남부집단", "북부집단", "연서집단", "연신내집단"];
        const others = [];

        let selectedParticipants = [];

        function openModal() {
            const modal = document.getElementById("modal");
            const participantList = document.getElementById("participantList");
            participantList.innerHTML = '';

            const categories = [
                { name: "형제", list: brothers },
                { name: "자매", list: sisters },
                { name: "자녀", list: children },
                { name: "집단", list: groups },
                { name: "기타", list: others }
            ];

            categories.forEach(category => {
                const categoryDiv = document.createElement("div");
                categoryDiv.className = "participant-category";
                categoryDiv.innerHTML = `<h3>${category.name}</h3>`;
                category.list.forEach(person => {
                    const container = document.createElement("div");
                    container.className = "checkbox-container";
                    const checkbox = document.createElement("input");
                    checkbox.type = "checkbox";
                    checkbox.value = person;
                    checkbox.id = person;
                    checkbox.checked = selectedParticipants.includes(person);
                    const label = document.createElement("label");
                    label.htmlFor = person;
                    label.textContent = person;
                    container.appendChild(checkbox);
                    container.appendChild(label);
                    categoryDiv.appendChild(container);
                });
                participantList.appendChild(categoryDiv);
            });

            modal.style.display = "block";
        }

        function closeModal() {
            document.getElementById("modal").style.display = "none";
        }

        function confirmSelection() {
            selectedParticipants = [];
            const checkboxes = document.querySelectorAll("#participantList input[type=checkbox]:checked");
            checkboxes.forEach(checkbox => {
                selectedParticipants.push(checkbox.value);
            });
            document.getElementById("selectedParticipants").textContent = `선택된 참여자: ${selectedParticipants.join(", ")}`;
            closeModal();
        }

        function generateSchedule() {
            if (selectedParticipants.length < 2) {
                alert("최소 2명 이상의 참여자를 선택해주세요.");
                return;
            }

            const stands = parseInt(document.getElementById("stands").value);
            const startTime = document.getElementById("startTime").value;
            const endTime = document.getElementById("endTime").value;
            const shiftDuration = 20; // 20분 고정

            const startMinutes = timeToMinutes(startTime);
            const endMinutes = timeToMinutes(endTime);
            const totalMinutes = endMinutes - startMinutes;
            const numSlots = totalMinutes / shiftDuration;

            if (numSlots <= 0 || totalMinutes % shiftDuration !== 0) {
                alert("유효하지 않은 시간 설정입니다. 20분 간격으로 설정해주세요.");
                return;
            }

            const shuffledParticipants = shuffleArray([...selectedParticipants]);
            const pairs = [];
            for (let i = 0; i < shuffledParticipants.length; i += 2) {
                if (i + 1 < shuffledParticipants.length) {
                    pairs.push([shuffledParticipants[i], shuffledParticipants[i + 1]]);
                } else {
                    pairs.push([shuffledParticipants[i]]);
                }
            }

            if (pairs.length < stands) {
                alert("전시대 수보다 쌍이 적습니다.");
                return;
            }

            const timeSlots = [];
            for (let t = 0; t < numSlots; t++) {
                const slotStart = startMinutes + t * shiftDuration;
                const slotEnd = slotStart + shiftDuration;
                timeSlots.push({
                    start: minutesToTime(slotStart),
                    end: minutesToTime(slotEnd)
                });
            }

            let scheduleHtml = '<table><thead><tr><th>시간대</th>';
            for (let s = 0; s < stands; s++) {
                scheduleHtml += `<th>전시대 ${s + 1}</th>`;
            }
            scheduleHtml += '</tr></thead><tbody>';
            for (let t = 0; t < numSlots; t++) {
                scheduleHtml += `<tr><td>${timeSlots[t].start} - ${timeSlots[t].end}</td>`;
                for (let s = 0; s < stands; s++) {
                    const pairIndex = (t + s) % pairs.length;
                    const pair = pairs[pairIndex].join("-");
                    scheduleHtml += `<td>${pair}</td>`;
                }
                scheduleHtml += '</tr>';
            }
            scheduleHtml += '</tbody></table>';
            document.getElementById("schedule").innerHTML = scheduleHtml;
        }

        function timeToMinutes(timeStr) {
            const [hours, minutes] = timeStr.split(":").map(Number);
            return hours * 60 + minutes;
        }

        function minutesToTime(minutes) {
            const hours = Math.floor(minutes / 60);
            const mins = minutes % 60;
            return `${hours.toString().padStart(2, '0')}:${mins.toString().padStart(2, '0')}`;
        }

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        document.getElementById("modal").addEventListener('click', (e) => {
            if (e.target === document.getElementById("modal")) closeModal();
        });
    </script>
</body>
</html>